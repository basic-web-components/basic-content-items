<!--
Aspect that lets a component collective DOM content as list items.

@element basic-content-items
-->

<link rel="import" href="../basic-aspect/basic-aspect.html">

<script>

/**
 * Fires when the items in the list change.
 *
 * @event items-changed
 */

Polymer({

  behaviors: [Basic.Aspect],

  contribute: {

    applySelection: function(item, selected) {
      item.classList.toggle('selected', selected);
    },

    contentChanged: function() {
      if (this.itemsChanged) {
        this.itemsChanged();
      }
    },

    /**
     * Returns the positional index for the indicated item.
     *
     * @method indexOfItem
     * @param {Object} item The item whose index is requested.
     * @returns {Number} The index of the item, or -1 if not found.
     */
    indexOfItem: function(item) {
      return this.items.indexOf(item);
    },

    itemsChanged: function() {
      // Perform per-item initialization.
      this.items.forEach(function(item) {
        if (!item._itemInitialized) {
          this.itemAdded(item);
          item._itemInitialized = true;
        }
      }.bind(this));

      var event = new CustomEvent('items-changed', {
        bubbles: true
      });
      this.dispatchEvent(event);
    },

    /**
     * The current set of items in the list.
     *
     * @property items
     * @type [Object]
     */
    get items() {
      // TODO: Memoize
      // TODO: Filter out auxiliary content.
      // TODO: property notifications so elements can bind to this property
      return this.content;
    }

  },

  is: 'basic-content-items',

  // Default implementations do nothing. These will usually be overwritten by
  // collective methods.
  itemAdded: function() {},
  itemsChanged: function() {}

});
</script>
